version: 2

models:
  - name: int_local_bike_database__orders_enriched
    description: "This model is based on the stg_local_bike_database__order_items model and is enriched with product, customer, store and staff information"
    columns:
      - name: order_item_sk
        description: "Primary key, unique identifier for each order x item combination: generated by concantenation of order_id and item_id"
        tests:
            - unique
            - not_null
      - name: order_id
        description: "Unique identifer for each order. Foreign key linking the order x item to the corresponding order"
        tests:
          - relationships:
              name: order_id_foreign_key_in_stg_local_bike_database__order_items
              to: ref('stg_local_bike_database__orders')
              field: order_id
      - name: item_id
        description: "Unique identifer for each item in a given order"
      - name: product_id
        description: "Unique identifer for each product. Foreign key linking the order x item to the corresponding product"
        tests:
          - relationships:
              name: product_id_foreign_key_in_stg_local_bike_database__order_items
              to: ref('stg_local_bike_database__product')
              field: product_id
      - name: item_discount
        description: "Discount applied to the item. Between 0 and 1"
      - name: item_total_amount
        description: "Total amount of the order line before discount calculated as item_quantity * item_list_price_per_unit"
      - name: item_discount_amount
        description: "Total amount of the discount applied to the order line, calculated as item_total_amount * item_discount"
      - name: item_final_amount
        description: "Final amount of the order line with discount applied, calculated as item_total_amount - item_discount_amount"
      - name: staff_name
        description: "Concatenation of first and last name of the staff member who took the order"


  - name: int_local_bike_database__customer_consolidated
    description: '{{ doc("int_local_bike_database__customer_consolidated") }}'
    columns:
      - name: customer_id
        description: "Primary key, unique identifier for customer"
        tests:
            - unique
            - not_null
      - name: customer_total_orders
        description: "Total number of orders for the consumer"
      - name: customer_total_items
        description: "Total number of items for the consumer"
      - name: customer_lifetime_value
        description: "Sum of all customer's order amounts"
      - name: customer_recency
        description: "Number of days since customer's last order"
